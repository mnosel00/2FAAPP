<div class="container">
  <div *ngIf="!registrationSuccess; else qrCodeSection">
    <h2>Rejestracja</h2>
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      
      <div class="form-group mb-3">
        <label for="email">Adres Email</label>
        <input type="email" id="email" class="form-control" formControlName="email">
        <!-- Komunikaty o błędach dla email -->
        <div *ngIf="registerForm.get('email')?.invalid && (registerForm.get('email')?.dirty || registerForm.get('email')?.touched)" class="text-danger mt-1">
          <small *ngIf="registerForm.get('email')?.errors?.['required']">Adres e-mail jest wymagany.</small>
          <small *ngIf="registerForm.get('email')?.errors?.['email']">Nieprawidłowy format adresu e-mail.</small>
        </div>
      </div>

      <div class="form-group mb-3">
        <label for="password">Hasło</label>
        <input type="password" id="password" class="form-control" formControlName="password">
        <!-- Komunikaty o błędach dla hasła -->
        <div *ngIf="registerForm.get('password')?.invalid && (registerForm.get('password')?.dirty || registerForm.get('password')?.touched)" class="text-danger mt-1">
          <small *ngIf="registerForm.get('password')?.errors?.['required']">Hasło jest wymagane.</small>
          <small *ngIf="registerForm.get('password')?.errors?.['minlength']">Hasło musi mieć co najmniej 8 znaków.</small>
          <small *ngIf="registerForm.get('password')?.errors?.['pattern']">Hasło musi zawierać dużą i małą literę, cyfrę oraz znak specjalny.</small>
        </div>
      </div>

      <div class="form-group mb-3">
        <label for="confirmPassword">Potwierdź Hasło</label>
        <input type="password" id="confirmPassword" class="form-control" formControlName="confirmPassword">
        <!-- Komunikat o błędzie dla potwierdzenia hasła -->
        <div *ngIf="registerForm.get('confirmPassword')?.invalid && (registerForm.get('confirmPassword')?.dirty || registerForm.get('confirmPassword')?.touched)" class="text-danger mt-1">
          <small *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">Potwierdzenie hasła jest wymagane.</small>
        </div>
        <!-- Komunikat o niezgodności haseł -->
        <div *ngIf="registerForm.errors?.['passwordsMismatch'] && registerForm.get('confirmPassword')?.touched" class="text-danger mt-1">
          <small>Hasła nie są zgodne.</small>
        </div>
      </div>

      <button type="submit" [disabled]="registerForm.invalid" class="btn btn-primary">Zarejestruj</button>
      
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        {{ errorMessage }}
      </div>
    </form>
    <div class="text-center mt-3">
      <p>Masz już konto? <a routerLink="/login">Zaloguj się</a></p>
    </div>
  </div>

  <ng-template #qrCodeSection>
    <div class="text-center">
      <h2>Rejestracja zakończona pomyślnie!</h2>
      <p>Zeskanuj poniższy kod QR w swojej aplikacji uwierzytelniającej (np. Google Authenticator).</p>
      
      <div *ngIf="registrationData">
        <qrcode 
            [qrdata]="registrationData.qrCodeUri"
            [width]="256"
            [errorCorrectionLevel]="'M'">
        </qrcode>

        <p class="mt-3">Lub ręcznie wprowadź klucz konfiguracyjny:</p>
        <p><strong>{{ registrationData.setupKey }}</strong></p>
      </div>

      <p>Po skonfigurowaniu aplikacji, możesz się zalogować.</p>
       <a routerLink="/login" class="btn btn-success mt-3">Przejdź do logowania</a>
    </div>
  </ng-template>
</div>