<div class="container">
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <div *ngIf="mode === 'register' || mode === 'login'">
    <h2>{{ mode === 'register' ? 'Rejestracja' : 'Logowanie' }}</h2>

    <form [formGroup]="authForm" (ngSubmit)="onSubmitAuth()">
      <div class="form-group">
        <label for="email">Email:</label>
        <input id="email" type="email" class="form-control" formControlName="email" />
        <div
          *ngIf="authForm.get('email')?.invalid && authForm.get('email')?.touched"
          class="text-danger"
        >
          Wprowadź poprawny adres email.
        </div>
      </div>

      <div class="form-group">
        <label for="password">Hasło:</label>
        <input id="password" type="password" class="form-control" formControlName="password" />
        <div
          *ngIf="authForm.get('password')?.invalid && authForm.get('password')?.touched"
          class="text-danger"
        >
          Hasło musi mieć co najmniej 8 znaków i zawierać cyfrę.
        </div>
      </div>

      <button type="submit" [disabled]="authForm.invalid" class="btn btn-primary mt-3">
        {{ mode === 'register' ? 'Zarejestruj się' : 'Zaloguj się' }}
      </button>
    </form>

    <p class="mt-3">
      <span *ngIf="mode === 'register'"
        >Masz już konto? <a (click)="switchMode('login')">Zaloguj się</a></span
      >
      <span *ngIf="mode === 'login'"
        >Nie masz konta? <a (click)="switchMode('register')">Zarejestruj się</a></span
      >
    </p>
  </div>

  <div *ngIf="mode === '2fa'">
    <h2>Weryfikacja Dwustopniowa (2FA)</h2>

    <div *ngIf="qrCodeUri" class="qr-code-section mb-4">
      <p>Zeskanuj ten kod QR za pomocą aplikacji **Google Authenticator**:</p>
      <img
        [src]="qrCodeUri"
        alt="QR Code"
        style="width: 150px; height: 150px; border: 1px solid #ccc"
      />
      <p class="mt-2">
        **Klucz ręczny (Secret Key):** <span class="font-weight-bold">{{ setupKey }}</span>
      </p>
      <hr />
    </div>

    <form [formGroup]="otpForm" (ngSubmit)="onVerify2FA()">
      <div class="form-group">
        <label for="otpCode">Kod OTP z aplikacji (6 cyfr):</label>
        <input id="otpCode" type="text" class="form-control" formControlName="code" maxlength="6" />
        <div
          *ngIf="otpForm.get('code')?.invalid && otpForm.get('code')?.touched"
          class="text-danger"
        >
          Kod musi być 6-cyfrową liczbą.
        </div>
      </div>
      <button type="submit" [disabled]="otpForm.invalid" class="btn btn-success mt-3">
        Zweryfikuj i Zaloguj
      </button>
    </form>
  </div>

  <div *ngIf="mode === 'profile'">
    <h2>Strona Profilowa</h2>
    <div class="alert alert-info">{{ profileMessage }}</div>
    <button (click)="onLogout()" class="btn btn-warning">Wyloguj się</button>
  </div>
</div>
